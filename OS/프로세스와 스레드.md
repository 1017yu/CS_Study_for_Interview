# CS

## 프로세스와 스레드

- 프로세스: 운영체제로부터 자원을 할당받은 작업의 단위
- 스레드: 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위

### 프로세스와 스레드는 어디에 존재하는가?

- 프로그램 > 프로세스 > 스레드

#### Computer program

- 컴퓨터에서 실행될 때 특정 작업(specific task)을 **수행하는 일련의 명령어들의 모음(집합)** 즉, 코드덩어리라고 볼 수 있다

- **파일이 저장 장치에 저장**되어 있지만 **메모리에는 올라가 있지 않은** 정적인 상태

- 여기서 프로그램이 실행되려면 **OS(운영체제)가 프로그램에게 실행에 필요한 독립적인 메모리를 할당**해 주어야 한다

#### Process

  <img width="788" alt="image" src="https://github.com/7-7-2/DDocker_FE/assets/125563995/b9372b96-bdfb-4cbe-8ccc-f1914eb39418">

- 저장 장치에 있던 파일이 **메모리에 할당되어 실행중인 동적**인 상태

- 프로그램을 **실행**하게 되면 프로그램이 메모리에 할당되어 올라가게 되고, 이렇게 **실행되어진 상태의 프로그램**을 **프로세스**라고 한다

  - 독립된 메모리 영역을 *Code/Data/Stack/Heap*의 형식으로 할당해 각각의 프로세스에게 준다

    - 코드 영역(Code / Text) : 프로그래머가 작성한 프로그램 함수들의 코드가 CPU가 해석 가능한 기계어 형태로 저장되어 있다.

    - 데이터 영역(Data) : 코드가 실행되면서 사용하는 전역 변수나 각종 데이터들의 모임
      데이터영역은 .data ,.rodata, .bss 영역으로 세분화 된다

      - data : 전역 변수 또는 static 변수 등 프로그램이 사용하는 데이터를 저장
      - BSS : 초기값 없는 전역 변수, static 변수가 저장
      - rodata : const같은 상수 키워드 선언 된 변수나 문자열 상수가 저장

    - **스택 영역(Stack) : 지역 변수와 같은 호출한 함수가 종료되면 되돌아올 임시적인 자료를 저장하는 독립적인 공간 Stack은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸**
    - 힙 영역(Heap) : 생성자, 인스턴스와 같은 동적으로 할당되는 데이터들을 위해 존재하는 공간 사용자에 의해 메모리 공간이 동적으로 할당되고 해제된다

- _따라서,_ 긱긱의 프로세스들의 서로간의 _메모리를 공유할수 없다_

  <img width="777" alt="image" src="https://github.com/7-7-2/DDocker_FE/assets/125563995/7ad89a06-2d3c-4d7a-b96d-5ff12e15b8b9">

#### Process && Thread

- 과거 프로그램을 실행할때는 한개의 프로세스만 사용했지만 프로그램이 커지고 복잡해지면서 프로세스 하나만으로 프로그램을 실행하는데 한계가 생김
- 프로그램 사용의 시간 소모 증가
  - 하나의 프로그램을 여러개의 프로세스로 나눠 사용하는 방식
    - **_But!_** 그만큼 _메모리를 차지하고 CPU에서 할당받는 자원이 중복 된다는 문제점 발생_
  - *이러한 프로세스의 한계를 해결하기 위해 **Thread**가 탄생*함

#### Thread

  <img width="771" alt="image" src="https://github.com/7-7-2/DDocker_FE/assets/125563995/bffc5ad1-b11c-4bb8-baf5-6446778d6d46">

  <img width="790" alt="image" src="https://github.com/7-7-2/DDocker_FE/assets/125563995/570fbeb4-83ca-47ca-a820-0835bc3b20a0">

- 스레드(thread)란 프로세스(process) 내에서 **실제로 작업을 수행하는 주체**이며 진행되는 작업 갈래, 흐름의 단위를 뜻 한다

  - 모든 프로세스에는 **한 개 이상의 스레드가 존재**하여 작업을 수행합니다.

  - 두 개 이상의 스레드를 가지는 프로세스를 멀티스레드 프로세스(multi-threaded process)라고 한다

  <img width="780" alt="image" src="https://github.com/7-7-2/DDocker_FE/assets/125563995/eb967654-6d32-43c8-9d1f-421891adfda6">

  #### Thread 작동방식과 자원공유

  - 스레드는 프로세스와 다르게 **스레드 간 메모리를 공유하며 작동**

  - 프로세스가 할당받은 메모리 영역 내에서 Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 나머지 **Code/Data/Heap 형식으로 할당된 메모리 영역을 공유**한다

  - 따로 할당 받은독립적인 스택을 가졌다는 것은 독립적인 함수 호출이 가능하다 라는 의미이며 **독립적인 함수 호출이 가능**하다는 것은 독립적인 실행 흐름이 추가된다는 말이다

  - 따라서 각각의 스레드는 **별도의 스택을 가지고 동작하지만 힙 메모리는 서로 읽고 쓸 수 있게 있다**

  - **_BUT!_** 이라한 특징 때문에 하나의 스레드에서 오류가 발생하게 되면 같은 프로세스 내의 다른 스레드 모두가 강제로 종료된다

    - 그렇다면 왜 이러한 방식으로 메모리를 공유하는 것일까?
      - 스레드는 OS 입장이 아닌, CPU 입장에서의 최소 작업 단위이기 때문이다
      - CPU는 작업을 처리할 때 스레드를 최소 단위로 삼고 작업을 하는 반면 운영체제는 이렇게 작은 단위까지 직접 작업하지 않기 때문에 운영체제 관점에서는 프로세스가 최소 작업 단위가 된다 따라서 프로세스에 할당된 메모리를 공유 할 수 밖에 없는것이다

  > **_프로세스와 스레드는 개념의 범위부터 다르다! 스레드는 프로세스 안에 포함되어 있기 때문_**
