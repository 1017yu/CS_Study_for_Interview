# SSL & TLS

![image](https://github.com/livable-final/client/assets/83483378/2cb48b23-e95a-4714-8c64-259f7893cc95)

## HTTPS

웹 브라우저와 웹 서버 간에 데이터를 주고받기 위해 사용하는 인터넷 프로토콜인 `HTTP`는 내용이 암호화되지 않아 탈취의 문제에 노출되어 있었다.

HTTP의 보안을 위해 `HTTPS` 프로토콜이 탄생하게 되었다.

![image](https://github.com/livable-final/client/assets/83483378/93caaec5-acc4-4f97-9102-783b1713ef1d)

<br />

`HTTPS`는 일반적인 평문이 들어있는 HTTP의 페이지를 `SSL`이라는 기술을 통해 암호화하여 서로 주고받기 위한 기술이라 할 수 있다.

`HTTPS`를 사용하면 HTTP 메시지에 포함되는 콘텐츠 정보(평문)에 보안 요소가 추가되기 때문에 데이터를 안전하게 주고받을 수 있게 된다.

계층 구조로 보자면 HTTPS는 아래 그림과 같이 HTTP 계층 아래에 SSL이라는 보안 계층이 추가된 모습이다.

![image](https://github.com/livable-final/client/assets/83483378/190aa491-877c-454f-abdb-87deb240e470)

## SSL이란 (Secure Socket Layer)

`SSL`이란 신뢰할 수 있는 제 3자가 발행한 인증서를 통해 별도로 발급한 암호화 키를 가지고 클라이언트와 서버가 서로 암호화된 통신을 하는 프로토콜이다.

클라이언트와 서버가 서로 데이터를 암호화해 통신할 수 있도록 돕는 보안 계층이라고 할 수 있다.

## TLS이란 (Transport Layer Security)

SSL을 검색하다보면 `TLS`이라는 단어가 함께 따라다니는 것을 종종 볼 수 있는데,

사실 이 둘은 약간의 차이는 있지만 같은 보안 프로토콜에서 시작했다.

SSL 버전 3.0 다음부터 등장한 SSL의 이름을 `TLS`로 변경하게 되었지만,사람들이 SSL이란 이름에 더 익숙하다 보니, 대다수의 보안 프로토콜이 `TLS`로 교체되어 더 이상 SSL을 사용하고 있지 않은 지금까지도 계속 SSL이라고 부르고 있다.

## SSL의 암호화

그렇다면 SSL은 어떤 방식으로 안전하게 평문을 암호화하여 지금까지 필수적으로 요구되고 있을까? 아래에서 그 암호화 방식을 알아보자 :>

---

### 대칭 키 (공용 키) 방식

![image](https://github.com/livable-final/client/assets/83483378/34ae465e-63f7-4d52-bcde-1e46d64654f8)

클라이언트와 서버 모두 `동일한 키`를 이용하여 암·복호화하는 방식으로, 구조가 단순하기 때문에 속도가 빠르다는 장점이 있지만, 양 측의 키가 같기 때문에 키를 전송하는 과정에서 탈취 가능성이 있다. 이를 방지하려면 `공용 키`를 주기적으로 변경해야한다.

속도의 강점을 가지고 있지만 보안상 단점을 가진 이 방식은 완벽히 채택되지 않았다.

---

### 비대칭 키 방식

![image](https://github.com/livable-final/client/assets/83483378/2baedeff-673c-46e0-91bf-e38ab05cb469)

1. 클라이언트는 공개 키로 암호화
2. 서버는 유일하고 노출되지 않는 비밀 키로 복호화

클라이언트와 서버가 서로 다른 암호화 키, 복호화 키를 사용하는 방식으로서, 모두에게 공개 가능한 `공개 키(public)`와 한 쪽에서만 사용하는 `비밀 키(secret)` 방식을 사용한다.

한 쪽의 비밀 키를 전송하지 않아도 되므로 키 분배 문제는 없어지는 장점을 챙겼지만, 키의 길이가 매우 길고 그에 따른 처리가 복잡하기 때문에 속도가 느리다는 단점을 가지고 있다.

---

### 하이브리드 방식

![image](https://github.com/livable-final/client/assets/83483378/a1923985-58a1-4073-8297-5c2f22c6798d)

`SSL`은 궁극적으로 하이브리드 방식을 채택했다.

발신자가 비대칭 키 방식의 <span style="color:red">공개 키(public)</span>로 <span style="color:#C0FFFF">대칭(공용) 키</span>를 암호화하여 상대방에게 전송한 후,

수신자가 `비밀 키(secret)`로 해당 <span style="color:#C0FFFF">대칭(공용) 키</span>를 복호화하는 방식을 의미한다.

---

## SSL 동작

SSL은 크게 `3-way handshake, 세션, 세션 종료` 세 단계로 이루어진다.

![image](https://github.com/livable-final/client/assets/83483378/b9669690-63aa-4767-a0a6-2effb8d3e21f)

**1단계**

클라이언트는 서버에게 인사를 건넨다. 이 때 `랜덤한 데이터와 현재 지원할 수 있는 암호화 방식`을 서버에 전달한다. (같은 하이브리드 기법 내에서 서로 어떤 암호화를 진행할 지 협의)

**2단계**

인사를 받은 서버는 똑같이 클라이언트에 인사를 건넨다. 이 때 서버는 세 가지 내용을 전달하게 되는데, `랜덤 데이터와 지원 가능한 암호화 방식, 그리고 인증서를 전달`하게 된다.

**3단계**

인증서를 받은 클라이언트는 이 인증서가 제대로 된 문서인지 검증하기 위해 서버가 전달한 인증서가 있는지 확인한다. 그리고 인증서가 있다면 한 번 더 철저히 확인하기 위해 CA(Certificate Authoriy)에서 공유하는 `공개키를 가지고 인증서를 복호화`한다. 만약 복호화에 성공한다면 이 인증서는 서버가 자신의 비밀키로 암호화를 했다는 것이 검증되니 드디어 서버를 신뢰할 수 있게 된다.

**4단계**

본격적으로 키를 주고받기 위해 클라이언트는 실제 데이터 통신에서 사용할 `대칭 키를 임시로 생성`한다. 이 대칭 키는 이때 앞서 클라이언트와 서버가 서로 주고받은 랜덤한 데이터를 조합해 임시 키는 노출되어서는 안되므로 `공개키로 암호화`해 서버에 전달한다.

**5단계**

키를 받은 서버는 자신이 갖고 있던 비밀키로 암호를 해독해 `임시 키`를 얻게 된다. 비로소 클라이언트와 서버는 같은 키를 갖게 되었다.

**6단계**

클라이언트와 서버의 임시 키는 일련의 과정을 거쳐 `세션 키`로 바뀌고, 이 세션 키를 이용해 본격적으로 통신을 시작하게 된다.

![image](https://github.com/livable-final/client/assets/83483378/b9669690-63aa-4767-a0a6-2effb8d3e21f)

---
